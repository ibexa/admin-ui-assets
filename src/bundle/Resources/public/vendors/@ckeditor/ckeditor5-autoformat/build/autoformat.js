/*!
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md.
 */
window.CKEditor5=window.CKEditor5||{},window.CKEditor5.autoformat=function(t){var e={};function o(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=5)}([function(t,e){t.exports=CKEditor5.dll},function(t,e,o){t.exports=o(0)("./src/core.js")},function(t,e,o){t.exports=o(0)("./src/typing.js")},function(t,e,o){t.exports=o(0)("./src/engine.js")},function(t,e,o){t.exports=o(0)("./src/utils.js")},function(t,e,o){"use strict";o.r(e),o.d(e,"Autoformat",(function(){return u}));var n=o(1),i=o(2),r=o(3),s=o(4);function d(t,e,o,n){let i,d=null;"function"==typeof n?i=n:(d=t.commands.get(n),i=()=>{t.execute(n)}),t.model.document.on("change:data",(a,c)=>{if(d&&!d.isEnabled||!e.isEnabled)return;const u=Object(s.first)(t.model.document.selection.getRanges());if(!u.isCollapsed)return;if("transparent"==c.type)return;const l=Array.from(t.model.document.differ.getChanges()),f=l[0];if(1!=l.length||"insert"!==f.type||"$text"!=f.name||1!=f.length)return;const g=f.position.parent;if(g.is("element","codeBlock"))return;if(g.is("element","listItem")&&"function"!=typeof n&&!["numberedList","bulletedList","todoList"].includes(n))return;if(d&&!0===d.value)return;const h=g.getChild(0),m=t.model.createRangeOn(h);if(!m.containsRange(u)&&!u.end.isEqual(m.end))return;const p=o.exec(h.data.substr(0,u.end.offset));p&&t.model.enqueueChange(e=>{const o=e.createPositionAt(g,0),n=e.createPositionAt(g,p[0].length),s=new r.LiveRange(o,n);if(!1!==i({match:p})){e.remove(s);const o=t.model.document.selection.getFirstRange(),n=e.createRangeIn(g);!g.isEmpty||n.isEqual(o)||n.containsRange(o,!0)||e.remove(g)}s.detach(),t.model.enqueueChange(()=>{t.plugins.get("Delete").requestUndoOnBackspace()})})})}function a(t,e,o,n){let i,r;o instanceof RegExp?i=o:r=o,r=r||(t=>{let e;const o=[],n=[];for(;null!==(e=i.exec(t))&&!(e&&e.length<4);){let{index:t,1:i,2:r,3:s}=e;const d=i+r+s;t+=e[0].length-d.length;const a=[t,t+i.length],c=[t+i.length+r.length,t+i.length+r.length+s.length];o.push(a),o.push(c),n.push([t+i.length,t+i.length+r.length])}return{remove:o,format:n}}),t.model.document.on("change:data",(o,i)=>{if("transparent"==i.type||!e.isEnabled)return;const s=t.model,d=s.document.selection;if(!d.isCollapsed)return;const a=Array.from(s.document.differ.getChanges()),u=a[0];if(1!=a.length||"insert"!==u.type||"$text"!=u.name||1!=u.length)return;const l=d.focus,f=l.parent,{text:g,range:h}=function(t,e){let o=t.start;return{text:Array.from(t.getItems()).reduce((t,n)=>!n.is("$text")&&!n.is("$textProxy")||n.getAttribute("code")?(o=e.createPositionAfter(n),""):t+n.data,""),range:e.createRange(o,t.end)}}(s.createRange(s.createPositionAt(f,0),l),s),m=r(g),p=c(h.start,m.format,s),b=c(h.start,m.remove,s);p.length&&b.length&&s.enqueueChange(e=>{if(!1!==n(e,p)){for(const t of b.reverse())e.remove(t);s.enqueueChange(()=>{t.plugins.get("Delete").requestUndoOnBackspace()})}})})}function c(t,e,o){return e.filter(t=>void 0!==t[0]&&void 0!==t[1]).map(e=>o.createRange(t.getShiftedBy(e[0]),t.getShiftedBy(e[1])))}class u extends n.Plugin{static get requires(){return[i.Delete]}static get pluginName(){return"Autoformat"}afterInit(){this._addListAutoformats(),this._addBasicStylesAutoformats(),this._addHeadingAutoformats(),this._addBlockQuoteAutoformats(),this._addCodeBlockAutoformats(),this._addHorizontalLineAutoformats()}_addListAutoformats(){const t=this.editor.commands;t.get("bulletedList")&&d(this.editor,this,/^[*-]\s$/,"bulletedList"),t.get("numberedList")&&d(this.editor,this,/^1[.|)]\s$/,"numberedList"),t.get("todoList")&&d(this.editor,this,/^\[\s?\]\s$/,"todoList"),t.get("checkTodoList")&&d(this.editor,this,/^\[\s?x\s?\]\s$/,()=>{this.editor.execute("todoList"),this.editor.execute("checkTodoList")})}_addBasicStylesAutoformats(){const t=this.editor.commands;if(t.get("bold")){const t=l(this.editor,"bold");a(this.editor,this,/(?:^|\s)(\*\*)([^*]+)(\*\*)$/g,t),a(this.editor,this,/(?:^|\s)(__)([^_]+)(__)$/g,t)}if(t.get("italic")){const t=l(this.editor,"italic");a(this.editor,this,/(?:^|\s)(\*)([^*_]+)(\*)$/g,t),a(this.editor,this,/(?:^|\s)(_)([^_]+)(_)$/g,t)}if(t.get("code")){const t=l(this.editor,"code");a(this.editor,this,/(`)([^`]+)(`)$/g,t)}if(t.get("strikethrough")){const t=l(this.editor,"strikethrough");a(this.editor,this,/(~~)([^~]+)(~~)$/g,t)}}_addHeadingAutoformats(){const t=this.editor.commands.get("heading");t&&t.modelElements.filter(t=>t.match(/^heading[1-6]$/)).forEach(e=>{const o=e[7],n=new RegExp(`^(#{${o}})\\s$`);d(this.editor,this,n,()=>{if(!t.isEnabled||t.value===e)return!1;this.editor.execute("heading",{value:e})})})}_addBlockQuoteAutoformats(){this.editor.commands.get("blockQuote")&&d(this.editor,this,/^>\s$/,"blockQuote")}_addCodeBlockAutoformats(){const t=this.editor,e=t.model.document.selection;t.commands.get("codeBlock")&&d(t,this,/^```$/,()=>{if(e.getFirstPosition().parent.is("element","listItem"))return!1;this.editor.execute("codeBlock",{usePreviousLanguageChoice:!0})})}_addHorizontalLineAutoformats(){this.editor.commands.get("horizontalLine")&&d(this.editor,this,/^---$/,"horizontalLine")}}function l(t,e){return(o,n)=>{if(!t.commands.get(e).isEnabled)return!1;const i=t.model.schema.getValidRanges(n,e);for(const t of i)o.setAttribute(e,!0,t);o.removeSelectionAttribute(e)}}}]);